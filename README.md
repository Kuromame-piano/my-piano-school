# ピアノ教室管理アプリケーション

Next.js 16 + React 19で構築されたピアノレッスン管理アプリケーション

## 主な機能

- 👥 生徒管理
- 📅 スケジュール管理（Googleカレンダー連携）
- 💰 レッスン料・経費管理
- 📄 請求書・領収書の発行（PDF）
- 📊 年間レポート（確定申告用）
- 🎵 楽譜ライブラリ
- 👨‍👩‍👧 保護者ポータル

## 開発環境のセットアップ

```bash
# 依存関係のインストール
npm install

# 開発サーバーの起動（Turbopack使用）
npm run dev

# 本番ビルド（Webpack使用 - PWAに必要）
npm run build
npm start
```

## 環境設定

### 1. Google API設定

`.env`ファイルを作成し、以下の環境変数を設定してください：

```env
SPREADSHEET_ID=<GoogleスプレッドシートのID>
CALENDAR_ID=<GoogleカレンダーのID>
GOOGLE_SERVICE_ACCOUNT_KEY=<サービスアカウントのJSONキー（本番環境用）>
```

ローカル開発では、プロジェクトルートに`service-account.json`を配置してください。

### 2. 教室情報の設定

請求書と領収書に表示される教室情報を設定するには、`src/lib/schoolConfig.ts`を編集してください：

```typescript
export const SCHOOL_CONFIG = {
  schoolName: "あなたのピアノ教室",
  teacherName: "先生の名前",
  address: "〒123-4567\n東京都〇〇区〇〇 1-2-3",
  phone: "03-1234-5678",
  email: "your-email@example.com",
  bankInfo: {
    bankName: "〇〇銀行",
    branchName: "〇〇支店",
    accountType: "普通",
    accountNumber: "1234567",
    accountHolder: "先生名",
  },
  paymentDueDays: 7,
};
```

## 請求書・領収書の使用方法

### 手順

1. アプリケーションにログイン
2. 「レッスン料・経費管理」タブを開く
3. 「請求書・領収書」サブタブを選択
4. 以下の情報を入力：
   - **書類タイプ**：請求書または領収書を選択
   - **生徒**：対象の生徒を選択（月謝が自動入力されます）
   - **対象月**：請求/領収の対象月
   - **金額**：レッスン料の金額
   - **内容/但し書き**：オプションで詳細を入力
5. 「ダウンロード」ボタンをクリックしてPDF生成

### 請求書の内容

- 発行日、請求番号
- 請求先（生徒名）
- 請求金額
- 支払期限（設定に基づいて自動計算）
- 振込先情報
- 発行者情報（教室名、住所、連絡先）

### 領収書の内容

- 発行日、領収書番号
- 宛名（生徒名）
- 金額
- 但し書き
- 発行者情報
- 印鑑欄（印刷後に押印してください）

### 法的要件について

生成されるPDFは日本の税法に準拠した形式で作成されますが、以下の点にご注意ください：

- **領収書**：印刷後、教室の印鑑を押印することを推奨します
- **記録保管**：発行した請求書・領収書のコピーは法定期間（7年間）保管してください
- **金額の正確性**：生成前に必ず金額と内容を確認してください

## データ構造

アプリケーションはGoogleスプレッドシートをデータベースとして使用します：

- **Students** - 生徒情報
- **Finance** - 収支記録
- **TuitionPayments** - 月謝の支払い状況
- **LessonPayments** - 都度払いの記録
- **その他** - カレンダーイベント、楽譜、発表会など

## デプロイ

Vercelへのデプロイ：

1. GitHubにコードをプッシュ
2. Vercelプロジェクトを作成
3. 環境変数を設定（`GOOGLE_SERVICE_ACCOUNT_KEY`など）
4. 自動デプロイが開始されます

## トラブルシューティング

### 請求書・領収書のPDFが正しく表示されない

- `src/lib/schoolConfig.ts`が正しく設定されているか確認してください
- ブラウザのコンソールでエラーメッセージを確認してください

### Google APIのエラー

- サービスアカウントにスプレッドシートとカレンダーへの適切な権限があるか確認してください
- 環境変数が正しく設定されているか確認してください

## ライセンス

Private
